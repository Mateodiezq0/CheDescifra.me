@page "/chedesciframe"

@using frontend.logic
@inject NavigationManager Navigation

<h3>Decipher Game</h3>

<div style="font-family: monospace;">
    @foreach (char c in gameLogic.CipherText)
    {
        if (char.IsLetter(c))
        {
            <input style="width: 30px; text-align: center;" maxlength="1" value="@GetMappedChar(c)" 
                   @oninput="(e) => UpdateSubstitution(c, ((ChangeEventArgs)e).Value?.ToString()?.ToUpper())" />
        }
        else
        {
            <span>@c</span>
        }
    }
</div>

<button @onclick="ResetGame" style="margin-top: 10px;">Reset</button>

@code {
    private GameLogic gameLogic = new GameLogic("DEFAULT");

    protected override void OnInitialized()
    {
        // Inicializa el juego con un texto cifrado
        gameLogic = new GameLogic("YOUTUBE CYPHER TEXT");
    }

    private string GetMappedChar(char cipherChar)
    {
        return gameLogic.SubstitutionMap.TryGetValue(cipherChar, out var plainChar) ? plainChar.ToString() : string.Empty;
    }
    
    private void UpdateSubstitution(char cipherChar, string? plainChar)
    {
        if (!string.IsNullOrEmpty(plainChar) && char.IsLetter(plainChar[0]))
        {
            gameLogic.SubstitutionMap[cipherChar] = plainChar[0];
        }
    }

    private void ResetGame()
    {
        gameLogic = new GameLogic("YOUTUBE CYPHER TEXT");
    }
}

<style>
    input {
        border: 1px solid #ccc;
        border-radius: 3px;
        padding: 5px;
        margin: 2px;
        font-size: 16px;
    }
</style>
